# Проектная работа "Веб-ларек"

Web-ларёк - интернет-магазин с товарами для веб-разработчиков.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, которые используются в приложении

Данные о товарах, получаемые с сервера
```
export interface IProductList {
	total: number;
	items: IProductItem[];
}
```

Данные одного товара
```
export interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```

Данные покупателя
```
export interface ICustomer {
	email: string
	address: string
	phone: string
	payment: string
}
```

Данные товара для корзины  
```
export type TProductBase = Pick<IProductItem, 'id' | 'title' | 'price'>
```

Данные покупателя для валидации форм
```
export type TCustomerInfo = Pick<ICustomer, 'phone' | 'email' | 'address'>
```

Данные для корзины
```
export interface IBasket {
	items: TProductBase[];
}
```

Данные для каталога
```
export interface ICatalog {
	items: IProductItem[];
	preview: string | null;
}
```

Интерфейс для отображения содержимого модального окна
```
export interface IContent {
    contentElement: HTMLElement;
}
```

### Архитерктура приложения

Код приложения разделен на слои согласно парадигме MVP:

 - слой представления, отвечает за отображение данных на странице
 - слой данных, отвечает за хранение и изменение данных
 - презентер, отвечает за связь представления и данных, роль которого выполняет брокер событий

Пример взаимодействия классов при открытии модального окна с подробным описанием товара с использованием событийно-ориентированного подхода:
1. В каталоге пользователь нажимает на карточку, класс `Card` реагирует на это и генерирует событие `card:open`.
2. Презентер обрабатывает событие `card:open` и вызывает метод `getItem(productId: string): IProductItem` класса `Catalog` для изменения данных
3. Класс `Catalog` изменяет данные и генерирует событие `catalog:selected`
4. Презентер обрабатывает событие `catalog:selected` и вызывает метод `setData(cardData: IProductItem & TProductBase): void` класса `Card`, передавая в него данные из модели
5. Класс `Modal` принимает в метод `render(content: IContent): HTMLElement` полученную карточку с данными выбранного товара и отображает о нем подробную информацию.

### Базовый код

#### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:
 - `get(uri: string) `- выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
 - `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
 - `handleResponse(response: Response)` - защищенный метод, который возвращает объект в виде json при успешном выполнении запроса. В случае неуспеха - статус и текст ошибки. Принимает в параметрах Response

#### Класс EventEmitter
Обеспечивает работу событий, реализуя методы интерфейса `IEvents`: 
  - `on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписывается на событие
  - `emit<T extends object>(event: string, data?: T): void` - уведомляет
подписчиков о наступлении события
 - `trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы.


### Слой данных

#### Класс Basket
Хранит данные о товарах, добавленных в корзину, и логику работы с этими данными.\
Конструктор принимает экземпляр класса `EventEmitter` для инициации событий при изменении данных.
В полях класса хранятся следующие данные:
- `_items: TProductBase[]` - массив товаров в корзине;
- `events: IEvents` - брокер событий;

Набор методов для взаимодействия с этими данными:
- `add(product: TProductBase): void` - добавляет товар в корзину и вызывает событие изменения состава корзины;
- `delete(productId: string): void` - удаляет товар из корзины и вызывает событие изменения состава корзины;
- `clear(): void` - очищает данные корзины после успешного оформления заказа;
- геттеры для получения данных из полей класса и сеттеры для их сохранения.
- `isContain(productId: string): boolean` - проверяет наличие товара в корзине;

#### Класс Catalog
Отвечает за получение массива товаров с сервера и его хранение, отвечает за логику открытия подробной информации о товаре.\
В конструктор передаются `items` - массив товаров, полученный с сервера, и экземпляр класса `EventEmitter` для инициации событий при изменении данных.
В полях хранятся следующие данные:
- `_items: IProductItem[]` - массив товаров;
- `_preview: string | null` - id товара для его просмотра;
- `events: IEvents` - брокер событий;

Методы:
- `getItem(productId: string): IProductItem` - возвращает товар по его id;
- геттеры для получения данных из полей класса и сеттеры для их сохранения.

#### Класс Customer
Хранит данные покупателя в виде объекта `ICustomerData`: почта, адрес, телефон и способ оплаты. В конструктор принимает объект `ICustomerData` и экземпляр класса `EventEmitter` для инициации событий при изменении данных. А также отвечает за логику работы с этими данными.

Поля класса:
- `_customerData: ICustomerData` - объект с данными покупателя;
- `events: IEvents` - брокер событий;

Методы:
- `checkValidation(data: Record<keyof TCustomerInfo, string>): boolean` - проверяет валидность ввведеных данных;
- `get customerData(): ICustomerData | string` - получает данные покупателя в виде пар 'ключ - значение' или только значения;
- `set customerData(data: Record<keyof ICustomerData, string>): void` - меняет данные покупателя;


### Слой представления

#### Класс Modal
Описывает модальное окно. В конструктор принимает два параметра: селектор модального окна `selector: string` и экземпляр класса `EventEmitter` для возможности инициации событий.\
Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.   

Поля класса:
- `modalContainer: HTMLElement` - элемент модального окна;
- `_modalContent: HTMLElement` - содержимое модального окна;
- `modalClose: HTMLButtonElement` - кнопка закрытия модального окна;
- `events: IEvents` - брокер событий;

Методы:
- `set modalContent (element: HTMLElement): void` - устанавливает содержимое модального окна;
- `render(content: IContent): HTMLElement` - отображает содержимое модального окна;

#### Абстрактный класс ContentStepByStep
Отвечает за активацию/деактивацию кнопки перехода к следующему шагу для модального окна корзины и формы. 

Поля:
- `modalButton: HTMLButtonElement` - кнопка перехода к следующему шагу;

Методы: 
- `setValid (isValid: boolean): void` - изменяет активность кнопки перехода к следующему шагу; 

#### Класс BasketView
Расширяет абстрактный класс `ContentStepByStep`.\
Отвечает за отображение корзины. Конструктор - `(selector: string, events: IEvents)` - принимает селектор для идентификации элемента и экземпляр класса `EventEmitter`.

Поля:
- `_contentElement: HTMLElement` - склонированный элемент корзины;
- `_cardsList: HTMLUListElement` - элемент списка для вывода добавленных карточек;
- `modalButton: HTMLButtonElement` - кнопка перехода к следующему шагу - к заполнению формы;
- `_total: HTMLElement` - элемент для отображения суммы корзины;
- `events: IEvents` - брокер событий;

Методы:
- `get contentElement(): HTMLElement` - геттер для получения карточки;
- `set cardsList(cards: HTMLElement[]): void` - добавляет элементы карточки в корзину;
-  `set total(value: number): void` - устанавливает сумму корзины;
- `setActive(): void` - проверяет наличие элементов карточки в корзине для изменения активности кнопки;

#### Класс Form
Расширяет абстрактный класс `ContentStepByStep`.\
Отвечает за отображение форм. При сабмите вызывает событие сохранения данных полей формы в виде объекта. Отображает ошибку, если хотя бы одно поле ввода не заполнено. Конструктор - `(selector: string, events: IEvents)` - принимает селектор для идентификации элемента и экземпляр класса `EventEmitter`.

Поля:
- `_contentElement: HTMLElement` - склонированный элемент формы;
- `_form: HTMLFormElement` - элемент формы;
- `formName: string` - значение атрибута name формы;
- `_formError: HTMLElement` - элемент для вывода ошибки под формой;
- `modalButton: HTMLButtonElement` - кнопка перехода к следующему шагу;
- `events: IEvents` - брокер событий;

Методы:
- `setError(value: string): void` - управляет отображением текста с ошибкой;
- `showError(): void` - отображает текст ошибки под формой;
- `hideError(): void` - скрывает текст ошибки;	
- `get contentElement(): HTMLElement` - геттер для получения элемента формы;

#### Класс OrderForm
Отвечает за отображение формы с именем `order`, наследуя класс `Form`.\
В конструктор принимает параметры, которые необходимы для родительского класса `Form`. 

Поля:
- `button: NodeListOf<HTMLInputElement>` - элементы кнопок для выбора способа оплаты;

Методы:
- `set payment (value: string): void` - отображает выбранное значение для способа оплаты;
- `set address (value: string): void` - устанавливает адрес доставки;

#### Класс ContactForm
Отвечает за отображение формы с именем `contact`, наследуя класс `Form`.\
В конструктор принимает параметры, которые необходимы для родительского класса `Form`. 

Методы:
- `set email (value: string): void` - устанавливает почту;
- `set phone(value: string): void` - устанавливает номер телефона;

#### Класс Card
Описывает карточку в любом представлении (в каталоге, в модальном окне с подробным описанием товара и в корзине), принимая в конструктор нужный темплейт и экземпляр класса `EventEmitter`. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события. 

Поля класса:
- `_contentElement: HTMLElement` - содержимое карточки - склонированный темплейт;
- `title: HTMLTitleElement` - элемент с заголовком карточки;
- `price: HTMLElement` - DOM элемент с ценой карточки;
- `category?: HTMLElement` - DOM элемент с категорией;
- `description?: HTMLElement` - DOM элемент с подробным описанием;
- `image: HTMLImageElement` - DOM элемент с картинкой;
- `button?: HTMLButtonElement` - элемент кнопки для удаления из корзины/добавления в корзину;
- `events: IEvents` - брокер событий;

Методы:
- `setData(cardData: IProductItem & TProductBase): void` - заполняет данными темплейт карточки;
- `get contentElement(): HTMLElement` - геттер для получения элемента карточки;

#### Класс MainPage
Отвечает за отображение главной страницы: карточки с товарами в каталоге и счетчик добавленных товаров в корзину рядом с ее иконкой. Устанавливает слушатель на иконку с корзиной.\
В конструктор принимает контейнер, в котором размещаются карточки, и экземпляр класса `EventEmitter`. 

Поля класса:
- `_container: HTMLElement` - контейнер, в котором размещаются карточки;
- `_basketCounter: HTMLElement` - элемент разметки с количеством добавленных товаров в корзину;
- `basketButton: HTMLButtonElement` - кнопка с иконкой корзины;
- `events: IEvents` - брокер событий;

Методы:
- `set basketCounter(value: number): void` - сеттер для отображения актуального количества товаров в корзине рядом с иконкой корзины;
- `set container(items: HTMLElement[]): void` - сеттер для отображения карточек в галерее.

#### Класс Success
Отвечает за отображение окна с успешно оформленным заказом. Устанавливает слушатель на кнопку.\
В конструктор принимает селектор для клонирования темплейта и экземпляр класса `EventEmitter`. 

Поля:
- `_contentElement: HTMLElement` - содержимое окна;
- `_description: HTMLElement` - элемент с описанием списанной суммы за заказ;
- `button: HTMLButtonElement` - элемент кнопки;
- `events: IEvents` - брокер событий;

Методы:
- `get contentElement(): HTMLElement` - геттер для получения содержимого модального окна;
- `set description(value: number): void` - сеттер для установления суммы за заказ.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом.

## Взаимодействие компонентов
Код взаимодействия слоя данных и представления, который выступает в качестве презентера, описан в файле `index.ts`.\
Генерация событий и их обработка происходит с помощью брокера событий, который также описан в файле `index.ts`.\
В файле `index.ts` сначала создаются экземпляры классов, а потом настраивается обработка событий. 

### Список событий, которые могут генерироваться в системе.

*События изменения данных (генерируются классами моделей данных):*
- `basket:changed` - изменение массива товаров в корзине
- `catalog:selected` - изменение данных о товаре, который открывается в модальном окне 
- `catalog:previewClear` - очистка данных товара, выбранного для показа в модальном окне

*События, вызванные взаимодействием пользователя с интерфейсом (генерируются классами представления):*
- `order:open` - открытие модального окна с формой выбора способа оплаты и адреса доставки
- `contacts:open` - открытие модального окна с формой ввода контактов
- `basketView:open` - открытие модального окна корзины
- `success:open` - открытие модального окна с успешно оформленным заказом
- `success:close` - закрытие модального окна с успешно оформленным заказом
- `card:open` - открытие модального окна с подробным описанием товара
- `card:delete` - удаление товара из корзины
- `card:add` - добавление товара в корзину
- `order:submit` - сохранение способа оплаты и адреса доставки покупателя в модальном окне
- `contacts:submit` - сохранение контактов покупателя в модальном окне
- `order:validation` - событие, сообщающее о необходимости валидации формы с адресом доставки
- `contacts:validation` - событие, сообщающее о необходимости валидации формы контактов
