# Проектная работа "Веб-ларек"

Web-ларёк - интернет-магазин с товарами для веб-разработчиков.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, которые используются в приложении

Данные одного товара
```
export interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```

Данные покупателя
```
export interface ICustomerData {
	email: string;
	address: string;
	phone: string;
	payment: string;
}
```

Данные товара для корзины
```
export type TProductBase = Pick<IProductItem, 'id' | 'title' | 'price'>
```

Данные для корзины
```
export interface IBasket {
	items: TProductBase[];
}
```

Данные для каталога
```
export interface ICatalog {
	items: IProductItem[];
	preview: string | null;
}
```

Тип данных для отправки заказа
```
export type TOrder = ICustomerData & {
	'items': string[];
	'total': number;
}
```

Данные, которые придут в ответ на успешно оформленный заказ
```
export type TOrderResponse = Pick<TOrder, 'total'> & {
	id: string;
}
```

### Архитерктура приложения

Код приложения разделен на слои согласно парадигме MVP:

 - слой представления, отвечает за отображение данных на странице
 - слой данных, отвечает за хранение и изменение данных
 - презентер, отвечает за связь представления и данных

Пример взаимодействия классов при открытии модального окна с подробным описанием товара с использованием событийно-ориентированного подхода:
1. В каталоге пользователь нажимает на карточку, класс `Card` реагирует на это и генерирует событие `card:open`.
2. Презентер обрабатывает событие `card:open` и передает данные id карточки в модель данных.
3. Класс `Catalog` изменяет данные и генерирует событие `catalog:selected`
4. Презентер обрабатывает событие `catalog:selected` и вызывает метод `getContentElement(cardData: Partial<IProductItem>): HTMLElement` класса `Card`
5. Класс отображения `Modal` принимает в метод `render(element: HTMLElement): HTMLElement` полученную карточку с данными выбранного товара и отображает о модальном окне подробную информацию.

### Базовый код

#### Класс API
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:
 - `get<T>(url: string, uri: string): Promise<T> `- выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
 - `change<T>(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<T>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
 - `handleResponse<T>(response: Response): Promise<T>` - защищенный метод, который возвращает объект в виде json при успешном выполнении запроса. В случае неуспеха - статус и текст ошибки. Принимает в параметрах Response

#### Класс EventEmitter
Обеспечивает работу событий, реализуя методы интерфейса `IEvents`:
  - `on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписывается на событие
  - `emit<T extends object>(event: string, data?: T): void` - уведомляет
подписчиков о наступлении события
 - `trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы.


### Слой данных

#### Класс Basket
Хранит данные о товарах, добавленных в корзину, и логику работы с этими данными.\
Конструктор принимает экземпляр класса `EventEmitter` для инициации событий при изменении данных.
В полях класса хранятся следующие данные:
- `_items: TProductBase[]` - массив товаров в корзине;
- `events: IEvents` - брокер событий;

Набор методов для взаимодействия с этими данными:
- `add(product: TProductBase): void` - добавляет товар в корзину и вызывает событие изменения состава корзины;
- `delete(productId: string): void` - удаляет товар из корзины и вызывает событие изменения состава корзины;
- `clear(): void` - очищает данные корзины после успешного оформления заказа;
- геттеры для получения данных из полей класса и сеттеры для их сохранения.
- `isContain(productId: string): boolean` - проверяет наличие товара в корзине;
- геттеры и сеттеры для работы с данными;

#### Класс Catalog
Отвечает за получение массива товаров с сервера и его хранение, за логику открытия подробной информации о товаре.\
В конструктор передается экземпляр класса `EventEmitter` для инициации событий при изменении данных.

В полях хранятся следующие данные:
- `_items: IProductItem[]` - массив товаров;
- `_preview: string | null` - id товара для его просмотра;
- `events: IEvents` - брокер событий;

Методы:
- `getItem(productId: string): IProductItem` - возвращает товар по его id;
- геттеры для получения данных из полей класса и сеттеры для их сохранения.

#### Класс Customer
Хранит данные покупателя в виде объекта `ICustomerData`: почта, адрес, телефон и способ оплаты. В конструктор принимает экземпляр класса `EventEmitter` для инициации событий при изменении данных. Отвечает за валидацию введенных данных.\

Поля класса:
- `_customerData: ICustomerData` - объект с данными покупателя;
- `events: IEvents` - брокер событий;

Методы:
- `checkValidation(data: Record<keyof TCustomerInfo, string>): boolean` - проверяет валидность ввведеных данных;
- `get customerData(): ICustomerData` - получает данные покупателя в виде пар 'ключ - значение';
- `setCustomerData(data: Record<keyof ICustomerData, string>): void` - меняет данные покупателя;


### Слой представления

#### Класс Modal
Описывает модальное окно. В конструктор принимает два параметра: селектор модального окна `selector: string` и экземпляр класса `EventEmitter` для возможности инициации событий.\
Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.

Поля класса:
- `modalContainer: HTMLElement` - элемент модального окна;
- `_contentElement: HTMLElement` - содержимое модального окна;
- `modalClose: HTMLButtonElement` - кнопка закрытия модального окна;
- `events: IEvents` - брокер событий;

Методы:
- `set contentElement (value: HTMLElement): void` - устанавливает содержимое модального окна;
- `render(element: HTMLElement): HTMLElement` - отображает содержимое модального окна;

Тип для отображения DOM элементов в модальном окне
```
export interface IContent {
    contentElement: HTMLElement;
}
```

#### Абстрактный класс ContentStepByStep
Отвечает за активацию/деактивацию кнопки перехода к следующему шагу для модального окна корзины и формы.

Поля:
- `modalButton: HTMLButtonElement` - кнопка перехода к следующему шагу;

Методы:
- `setValid (isValid: boolean): void` - изменяет активность кнопки перехода к следующему шагу;


#### Класс BasketView
Расширяет абстрактный класс `ContentStepByStep`.\
Отвечает за отображение корзины. Конструктор - `(selector: string, events: IEvents)` - принимает селектор для идентификации элемента и экземпляр класса `EventEmitter`.

Поля:
- `_contentElement: HTMLElement` - склонированный элемент корзины;
- `_cardsList: HTMLUListElement` - элемент списка для вывода добавленных карточек;
- `modalButton: HTMLButtonElement` - кнопка перехода к следующему шагу - к заполнению формы;
- `_total: HTMLElement` - элемент для отображения суммы корзины;
- `events: IEvents` - брокер событий;

Методы:
- `render(): HTMLElement` - метод для получения корзины;
- `set cardsList(cards: HTMLElement[]): void` - добавляет элементы карточки в корзину;
- `getCardsList(): HTMLUListElement ` - получает элементы карточки в корзине
-  `set total(value: number): number` - устанавливает сумму корзины;
- `setActive(): void` - проверяет наличие элементов карточки в корзине для изменения активности кнопки;


#### Класс Form
Расширяет абстрактный класс `ContentStepByStep`.\
Отвечает за отображение форм. При сабмите вызывает событие сохранения данных полей формы в виде объекта. Отображает ошибку, если хотя бы одно поле ввода не заполнено. Конструктор - `(template: HTMLTemplateElement, events: IEvents)` - принимает селектор для идентификации элемента и экземпляр класса `EventEmitter`.

Поля:
- `modalActions: HTMLElement` - элемент с кнопкой сабмита и элементом ошибки(для поиска кнопки сабмита)
- `form: HTMLFormElement` - элемент формы;
- `formName: string` - имя формы;
- `inputs: NodeListOf<HTMLInputElement>` - инпуты;
- `_formError: HTMLElement` - элемент для вывода ошибки под формой;
- `modalButton: HTMLButtonElement` - кнопка перехода к следующему шагу;
- `events: IEvents` - брокер событий;

Методы:
- `getInputValues(): Record<string, string>` - получает имя инпута и его значение в виде объекта;
- `setError(value: string): void` - управляет отображением текста с ошибкой;
- `showError(): void` - отображает текст ошибки под формой;
- `hideError(): void` - скрывает текст ошибки;
- `get form(): HTMLFormElement` - геттер для получения элемента формы;
- `reset(): void` - сброс данных формы;


#### Класс OrderForm
Отвечает за отображение формы с именем `order`, наследуя класс `Form`.\
В конструктор принимает параметры, которые необходимы для родительского класса `Form`. Устанавливаются слушатели на кнопки выпора способа оплаты.

Поля:
- ` buttonCard: HTMLButtonElement` - кнопка с именем card;
- ` buttonCash: HTMLButtonElement` - кнопка с именем cash;
- `button: NodeListOf<HTMLButtonElement>` - все кнопки для выбора способа оплаты;

Методы:
- `set payment (value: string): string` - отображает выбранное значение для способа оплаты;
- `set address (value: string): string` - устанавливает адрес доставки;
- `getInputValues(): Record<string, string>` - расширяет метод родительского класса, добавляя значение выбранного способа оплаты;
- `reset(): void` - расширяет метод родительского класса, сбрасывая значение выбранного способа оплаты;


#### Класс ContactForm
Отвечает за отображение формы с именем `contact`, наследуя класс `Form`.\
В конструктор принимает параметры, которые необходимы для родительского класса `Form`.

Методы:
- `set email (value: string): void` - устанавливает почту;
- `set phone(value: string): void` - устанавливает номер телефона;


#### Класс Card
Описывает карточку в любом представлении (в каталоге, в модальном окне с подробным описанием товара и в корзине), принимая в конструктор нужный селектор и экземпляр класса `EventEmitter`.\
Являяется родителем для трех классов: `CardCatalog, CardPreview, CardBasket`. В конструктор принимают параметры, необходимые для текущего класса `Card`.

Поля класса:
- `_contentElement: HTMLElement` - содержимое карточки - склонированный темплейт;
- `title: HTMLTitleElement` - элемент с заголовком карточки;
- `price: HTMLElement` - DOM элемент с ценой карточки;
- `events: IEvents` - брокер событий;
- `cardId: string` - id карточки;

Методы:
- `setData(cardData: Partial<IProductItem>): void` - заполняет данными темплейт карточки;
- `get contentElement(): HTMLElement` - геттер для получения элемента карточки;
- `get id (): string` - получение id;


#### Класс CardCatalog
Отвечает за отображение карточка в каталоге.\
Устанавливается слушатель на кнопку открытия карточки с подробным описанием, в результате которого генерируется соответствующее событие.

Поля:
- `category: HTMLElement` - DOM элемент с категорией;
- `image: HTMLImageElement` - DOM элемент с картинкой;

Методы:
- `set categoryColor(color: string) ` - устанавливает цвет элемента для разных категорий;
- `setData(cardData: Partial<IProductItem>): void` - дополняет метод родительского класса;


#### Класс CardPreview
Отображает карточку с подробным описанием.\
Устанавливается слушатель на кнопку добавления товара в корзину/ удаления из корзины.

Поля:
- `category: HTMLElement` - DOM элемент с категорией;
- `description: HTMLElement` - DOM элемент с подробным описанием;
- `image: HTMLImageElement` - DOM элемент с картинкой;
- `_button: HTMLButtonElement` - элемент кнопки для удаления из корзины/добавления в корзину;

Методы:
- `setButton(isClicked: boolean): void ` - устанавливает значение кнопки Удалить из корзины/В корзину в зависимости от полученного в параметрах true/false;
- `set categoryColor(color: string) ` - дополняет метод родительского класса;
- `setData(cardData: Partial<IProductItem>): void` - дополняет метод родительского класса;
- `removeCategoryColor(): void` - удаляет класс категории предыдущей открытой карточки;


#### Класс CardBasket
Отображает карточку в корзине.\
Устанавливается слушатель на кнопку удаления товара из корзины.

Поля:
-  `protected _button: HTMLButtonElement` - кнопка удаления;

#### Класс MainPage
Отвечает за отображение главной страницы: карточки с товарами в каталоге и счетчик добавленных товаров в корзину рядом с ее иконкой. Устанавливает слушатель на иконку с корзиной.\
В конструктор принимает контейнер, в котором размещаются карточки, и экземпляр класса `EventEmitter`.

Поля класса:
- `_container: HTMLElement` - элемент текущей страницы;
- `_gallery: HTMLElement` - элемент, в котором размещаются карточки;
- `_basketCounter: HTMLElement` - элемент разметки с количеством добавленных товаров в корзину;
- `basketButton: HTMLButtonElement` - кнопка с иконкой корзины;
- `_wrapper: HTMLElement` - элемент, который будет блокироваться при открытии модальных окон;
- `events: IEvents` - брокер событий;

Методы:
- `set basketCounter(value: number): void` - сеттер для отображения актуального количества товаров в корзине рядом с иконкой корзины;
- `set gallery(items: HTMLElement[]): HTMLElement[]` - сеттер для отображения карточек в галерее.
- `set locked(value: boolean): boolean` - устанавливает/отменяет блокировку страницу при открытом модальном окне;


#### Класс Success
Отвечает за отображение окна с успешно оформленным заказом. Устанавливает слушатель на кнопку.\
В конструктор принимает селектор и экземпляр класса `EventEmitter`.

Поля:
- `_contentElement: HTMLElement` - содержимое окна;
- `_total: HTMLElement` - элемент с описанием списанной суммы за заказ;
- `button: HTMLButtonElement` - элемент кнопки;
- `events: IEvents` - брокер событий;

Методы:
- `get contentElement(): HTMLElement` - геттер для получения содержимого модального окна;
- `set total(value: number): number` - сеттер для установления суммы заказа.


### Слой коммуникации

#### Класс LarekApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом.

## Взаимодействие компонентов
Код взаимодействия слоя данных и представления, который выступает в качестве презентера, описан в файле `index.ts`.\
Генерация событий и их обработка происходит с помощью брокера событий, который также описан в файле `index.ts`.\
В файле `index.ts` сначала создаются экземпляры классов, а потом настраивается обработка событий.

### Список событий, которые могут генерироваться в системе.

*События изменения данных (генерируются классами моделей данных):*
- `catalog:added` - получены карточки с сервера;
- `basket:change` - изменение массива товаров;
- `catalog:selected` - изменение данных о товаре, который открывается в модальном окне

*События, вызванные взаимодействием пользователя с интерфейсом (генерируются классами представления):*
- `order:submit` - сохранение способа оплаты и адреса доставки и открытие формы contacts
- `basketView:open` - открытие модального окна корзины
- `basket:change` - изменения в корзине
- `success:close` - закрытие модального окна с успешно оформленным заказом
- `card:open` - открытие модального окна с подробным описанием товара
- `card:change` - добавление/удаление карточки
- `contacts:submit` - сохранение данных формы contacts и отправка сформированного заказа на сервер
- `customer:validation` - валидация введенных данных
- `contacts:change` - изменение введенных данных в форме contacts
- `order:change` - изменение введенных данных в форме order
- `orderForm:open` - открытие модального окна с формой order
- `мodal:open` - открытие любого модального окна
- `мodal:close` - закрытие любого модального окна
