# Проектная работа "Веб-ларек"

Web-ларёк - интернет-магазин с товарами для веб-разработчиков.

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, которые используются в приложении

Данные о товарах, получаемые с сервера
```
export interface IProductList {
	total: number;
	items: IProductItem[];
}
```

Данные одного товара
```
export interface IProductItem {
	id: string;
	description: string;
	image: string;
	title: string;
	category: string;
	price: number;
}
```

Данные покупателя
```
export interface ICustomer {
	email: string
	address: string
	phone: string
	payment: string
}
```

Данные товара для корзины  
```
export type TProductBase = Pick<IProductItem, 'id' | 'title' | 'price'>
```

Данные товара для модального окна с успешно оформленным заказом и корзиной 
```
export type TBasketTotal = Pick<IBasket, 'total'>
```

Количество добавленных товаров в корзину для отображения на главной странице 
```
export type TBasketCounter = Pick<IBasket, 'counter'>
```

Данные покупателя для валидации форм
```
export type TCustomerInfo = Pick<ICustomer, 'phone' | 'email' | 'address'>
```

Данные для корзины
```
export interface IBasket {
	items: TProductBase[];
	counter: number;
	total: number;
}
```

Данные для каталога
```
export interface ICatalog {
	items: IProductItem[];
	preview: string | null;
}
```

### Архитерктура приложения

Код приложения разделен на слои согласно парадигме MVP:

 - слой представления, отвечает за отображение данных на странице
 - слой данных, отвечает за хранение и изменение данных
 - презентер, отвечает за связь представления и данных

### Базовый код

#### Класс API

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:
 - `get(uri: string) `- выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
 - `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт, переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.
 - `handleResponse(response: Response)` - защищенный метод, который возвращает объект в виде json при успешном выполнении запроса. В случае неуспеха - статус и текст ошибки. Принимает в параметрах Response

#### Класс EventEmitter

Обеспечивает работу событий, реализуя методы интерфейса `IEvents`: 
  - `on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписывается на событие
  - `emit<T extends object>(event: string, data?: T): void` - уведомляет
подписчиков о наступлении события
 - `trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - генерирует заданное событие с заданными аргументами. Это позволяет передавать его в качестве обработчика события в другие классы.

### Слой данных

#### Класс Basket

Хранит данные о товарах, добавленных в корзину, и логику работы с этими данными.\
Конструктор принимает пустой массив типа `TProductBase[]` с возможностью дальнейшего добавления/удаления товаров и экземпляр класса `EventEmitter` для инициации событий при изменении данных
В полях класса хранятся следующие данные:
- `_items: TProductBase[]` - массив товаров в корзине;
- `_counter: number` - счетчик добавленных товаров в корзину;
- `_total: number` - сумма товаров, добавленных в корзину;
- `events: IEvents` - брокер событий;

Набор методов для взаимодействия с этими данными:
- `add(product: TProductBase): void` - добавляет товар в корзину и вызывает событие изменения состава корзины;
- `delete(productId: string): void` - удаляет товар из корзины и вызывает событие изменения состава корзины;
- `clear(): void` - очищает данные корзины после успешного оформления заказа;
- геттеры для получения данных из полей класса и сеттеры для их сохранения.


#### Класс Catalog

Отвечает за получение массива товаров с сервера и его хранение, отвечает за логику открытия подробной информации о товаре.\
В конструктор передаются `items` - массив товаров, полученный с сервера, и экземпляр класса `EventEmitter` для инициации событий при изменении данных.
В полях хранятся следующие данные:
- `_items: IProductItem[]` - массив товаров;
- `_preview: string | null` - id товара для его просмотра;
- `events: IEvents` - брокер событий;

Методы:
- `getItem(productId: string): IProductItem` - возвращает товар по его id;
- геттеры для получения данных из полей класса и сеттеры для их сохранения.


#### Класс Customer

Хранит данные покупателя в виде объекта `ICustomerData`: почта, адрес, телефон и способ оплаты. В конструктор принимает объект `ICustomerData` и экземпляр класса `EventEmitter` для инициации событий при изменении данных. А также отвечает за логику работы с этими данными.\

Поля класса:
- `_customerData: ICustomerData` - объект с данными покупателя;
- `events: IEvents` - брокер событий;

Методы:
- `checkValidation(data: Record<keyof TCustomerInfo, string>): boolean` - проверяет валидность ввведеных данных;
- `get customerData(): ICustomerData | string` - получает данные покупателя в виде пар 'ключ - значение' или только значения;
- `set customerData(data: Record<keyof ICustomerData, string>): void` - меняет данные покупателя;


### Слой представления

#### Класс Modal
Описывает модальное окно, в котором можно отобразить содержимое любого темплейта. Для этого принимает в конструктор необходимый темплейт и экземпляр класса `EventEmitter` для возможности инициации событий.\
Предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.   

Поля класса:
- `modal: HTMLDivElement` - элемент модального окна;
- `contentElement: HTMLElement` - содержимое модального окна - склонированный темплейт;
- `events: IEvents` - брокер событий;

Методы:
- `open(template?: HTMLTemplateElement): HTMLDivElement` - принимает темплейт при открытии модального окна с корзиной;
- `setData(data: TBasketTotal): void` - заполняет данными темплейт модального окна корзины и оформленного заказа;

#### Класс Form
Описывает форму с полями ввода. При сабмите вызывает событие сохранения данных полей формы в виде объекта. Отображает ошибки при вводе невалидных данных и управляет активностью кнопки сабмита. В конструктор принимает элемент формы и экземпляр класса `EventEmitter`. 

Поля:
- `submitButton: HTMLButtonElement` - кнопка отправки формы;
- `_form: HTMLFormElement` - элемент формы;
- `formName: string` - значение атрибута name формы;
- `input: NodeListOf<HTMLInputElement>` - все поля ввода формы;
- `errors: Record<string, HTMLElement>` - объект с парами "поле ввода - элемент с текстом ошибки";

Методы
- `getInputValues(): Record<string, string>` - возвращает объект с парами "name инпута - введенное пользователем значение";
- `setValid(isValid: boolean): void` - изменяет активность кнопки отправки формы;
- `setError(data: { field: string, value: string, error: string }): void` - определяет, есть ли ошибка в поле ввода;
- `showError(errorMessage: string, field: string): void` - показывает полученное сообщение об ошибке под указанным полем ввода; 
- `hideError(field: string): void` - скрывает текст ошибки под указанным полем ввода;	
- `get form(): HTMLElement` - геттер для получения элемента формы

#### Класс Card

Описывает карточку в любом представлении (в каталоге, в модальном окне с подробным описанием товара и в корзине), принимая в конструктор нужный темплейт и экземпляр класса `EventEmitter`. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми генерируются соответствующие события. \

Поля класса:
- `contentElement: HTMLElement` - содержимое карточки - склонированный темплейт;
- `events: IEvents` - брокер событий;

Методы:
- `setData(cardData: IProductItem | TProductBase): void` - заполняет данными темплейт карточки;
- `render(): HTMLElement` - отображает заполненный элемент карточки;

#### Класс MainPage

Отвечает за отображение главной страницы: карточки с товарами в каталоге и счетчик добавленных товаров в корзину рядом с ее иконкой.\
В конструктор принимает контейнер, в котором размещаются карточки. 
Поля класса:
- `container: HTMLElement` - контейнер, в котором размещаются карточки;
- `basketCounter: HTMLElement` - элемент разметки с количеством добавленных товаров в корзину;
- `set basketCounter(data: TBasketCounter): TBasketCounter` - сеттер для отображения актуального количества товаров в корзине рядом с иконкой корзины;


### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы, реализующие взаимодействие с бэкендом.

## Взаимодействие компонентов
Код взаимодействия слоя данных и представления, который выступает в качестве презентера, описан в файле `index.ts`.\
Генерация событий и их обработка происходит с помощью брокера событий, который также описан в файле `index.ts`.\
В файле `index.ts` сначала создаются экземпляры классов, а потом настраивается обработка событий. 

### Список событий, которые могут генерироваться в системе.

*События изменения данных (генерируются классами моделей данных):*
- `basket:changed` - изменение массива товаров в корзине
- `catalog:selected` - изменение данных о товаре, который открывается в модальном окне 
- `catalog:previewClear` - очистка данных товара, выбранного для показа в модальном окне

*События, вызванные взаимодействием пользователя с интерфейсом (генерируются классами представления):*
- `order:open` - открытие модального окна с формой выбора способа оплаты и адреса доставки
- `contacts:open` - открытие модального окна с формой ввода контактов
- `мodal:open` - открытие модального окна с корзиной
- `мodal:select` - выбор карточки с товаром для отображения в модальном окне
- `card:delete` - удаление товара из корзины
- `card:add` - добавление товара в корзину
- `order:submit` - сохранение способа оплаты и адреса доставки покупателя в модальном окне
- `contacts:submit` - сохранение контактов покупателя в модальном окне
- `order:validation` - событие, сообщающее о необходимости валидации формы с адресом доставки
- `contacts:validation` - событие, сообщающее о необходимости валидации формы контактов
